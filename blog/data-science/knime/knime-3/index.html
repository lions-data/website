


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <link rel="canonical" href="https://lions-data.com/data-science/knime/knime-3/">
      
      
        <meta name="author" content="Lions Data, Ltd.">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.0">
    
    
      
        <title>KNIME 入門編 / クラスタリング - Lions Data / Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.b5d04df8.min.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.9ab2c1f8.min.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700%7CUbuntu+Mono&display=fallback">
        <style>body,input{font-family:"Ubuntu",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#knime" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://lions-data.com/" title="Lions Data / Blog" class="md-header-nav__button md-logo" aria-label="Lions Data / Blog">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Lions Data / Blog
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              KNIME 入門編 / クラスタリング
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://lions-data.com/" title="Lions Data / Blog" class="md-nav__button md-logo" aria-label="Lions Data / Blog">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Lions Data / Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Data Science
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Data Science" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Data Science
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" checked>
    
    <label class="md-nav__link" for="nav-2-1">
      KNIME
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="KNIME" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        KNIME
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="KNIME 概要" class="md-nav__link">
      KNIME 概要
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../knime-1/" title="KNIME 入門編 / 前処理" class="md-nav__link">
      KNIME 入門編 / 前処理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../knime-2/" title="KNIME 入門編 / 探索的データ分析" class="md-nav__link">
      KNIME 入門編 / 探索的データ分析
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        KNIME 入門編 / クラスタリング
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="KNIME 入門編 / クラスタリング" class="md-nav__link md-nav__link--active">
      KNIME 入門編 / クラスタリング
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#knime" class="md-nav__link">
    KNIME 入門編 / クラスタリング
  </a>
  
    <nav class="md-nav" aria-label="KNIME 入門編 / クラスタリング">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    ワークフロー全体
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    分析用データ読み込み
  </a>
  
    <nav class="md-nav" aria-label="分析用データ読み込み">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csv" class="md-nav__link">
    顧客データ + 利用履歴 CSVファイル 読込み
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    クラスタリング / 処理
  </a>
  
    <nav class="md-nav" aria-label="クラスタリング / 処理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    準備 / データ探索
  </a>
  
    <nav class="md-nav" aria-label="準備 / データ探索">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 月の利用回数の分布
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2. 会員期間の分布
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3. 退会会員数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4. 月額金額の分布
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5. 質的データの要約
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    正規化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    クラスタリング
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    クラスタリング 色指定
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    クラスタリング / 集計, 可視化
  </a>
  
    <nav class="md-nav" aria-label="クラスタリング / 集計, 可視化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    テーブル結合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    集計
  </a>
  
    <nav class="md-nav" aria-label="集計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    クラスター別退会者集計
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    クラスター別定期利用者集計
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    可視化
  </a>
  
    <nav class="md-nav" aria-label="可視化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-parallel-coordinates-plot" class="md-nav__link">
    1. Parallel Coordinates Plot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-1-scatter-plot-1" class="md-nav__link">
    2-1. Scatter Plot (1)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-2-scatter-plot-2" class="md-nav__link">
    2-2. Scatter Plot (2)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-conditional-box-plot" class="md-nav__link">
    3. Conditional Box Plot
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    まとめ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appendix" class="md-nav__link">
    Appendix / 利用ノード一覧
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../knime-4/" title="KNIME 実践編 / 解約予測" class="md-nav__link">
      KNIME 実践編 / 解約予測
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      CV (Computer Vision)
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="CV (Computer Vision)" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        CV (Computer Vision)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cv/tools/opencv-cvat/" title="OpenCV CVAT (アノテーションツール)" class="md-nav__link">
      OpenCV CVAT (アノテーションツール)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#knime" class="md-nav__link">
    KNIME 入門編 / クラスタリング
  </a>
  
    <nav class="md-nav" aria-label="KNIME 入門編 / クラスタリング">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    ワークフロー全体
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    分析用データ読み込み
  </a>
  
    <nav class="md-nav" aria-label="分析用データ読み込み">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csv" class="md-nav__link">
    顧客データ + 利用履歴 CSVファイル 読込み
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    クラスタリング / 処理
  </a>
  
    <nav class="md-nav" aria-label="クラスタリング / 処理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    準備 / データ探索
  </a>
  
    <nav class="md-nav" aria-label="準備 / データ探索">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 月の利用回数の分布
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2. 会員期間の分布
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3. 退会会員数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4. 月額金額の分布
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5. 質的データの要約
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    正規化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    クラスタリング
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    クラスタリング 色指定
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    クラスタリング / 集計, 可視化
  </a>
  
    <nav class="md-nav" aria-label="クラスタリング / 集計, 可視化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    テーブル結合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    集計
  </a>
  
    <nav class="md-nav" aria-label="集計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    クラスター別退会者集計
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    クラスター別定期利用者集計
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    可視化
  </a>
  
    <nav class="md-nav" aria-label="可視化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-parallel-coordinates-plot" class="md-nav__link">
    1. Parallel Coordinates Plot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-1-scatter-plot-1" class="md-nav__link">
    2-1. Scatter Plot (1)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-2-scatter-plot-2" class="md-nav__link">
    2-2. Scatter Plot (2)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-conditional-box-plot" class="md-nav__link">
    3. Conditional Box Plot
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    まとめ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appendix" class="md-nav__link">
    Appendix / 利用ノード一覧
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                  <h1>KNIME 入門編 / クラスタリング</h1>
                
                <h2 id="knime">KNIME 入門編 / クラスタリング</h2>
<ul>
<li>初版作成日: 2020-04-17</li>
<li>最終更新日: 2020-04-24</li>
</ul>
<p>今回は、すでにデータ整形が終わっている分析用データ <em>(トレーニングジム会員の利用履歴)</em> を使い 会員のクラスタリング <em>(クラスター分析)</em> を行い、それぞれのクラスターの行動の傾向を確認します。クラスタリングとは、異なる性質・特徴をもつものが混在する集合から似た性質・特徴を持つグループを作ることです。基本的なデータ解析手法としてデータマイニングでも頻繁に利用されている手法です。</p>
<p>クラスタリングの手法がいくつかありますが、今回は、非階層クラスタリングに属する <a href="https://en.wikipedia.org/wiki/K-means_clustering" target="_blank">k-means</a> を使います。 <strong>非階層クラスタリング</strong>は、予め作成するクラスター数を決定し、決めた数の階層を持たないクラスター <em>(グループ)</em> にサンプルを分割する方法です。サンプル数が極めて大きいビッグデータ分析に適しています。</p>
<h3 id="_1">ワークフロー全体</h3>
<p>整形後データ読み込んだ後に、クラスタリングを実行し、最後にクラスタリング結果の可視化と集計を行います。</p>
<ol>
<li>顧客+利用履歴データ <em>(CSV形式ファイル)</em> 読み込み</li>
<li>データ探索 <em>(確認)</em></li>
<li>クラスタリング</li>
<li>可視化 + 集計</li>
</ol>
<p><em>Fig. 全体ワークフロー</em></p>
<p><img alt="ワークフロー" src="../images/knime-3/workflow.png" /></p>
<h3 id="_2">分析用データ読み込み</h3>
<h4 id="csv">顧客データ + 利用履歴 CSVファイル 読込み</h4>
<p>読込み対象のCSVファイルの文字コードが <code>UTF-8</code> であることを事前に確認した後、KNIMEに 顧客データ + 利用履歴 <em>(CSV)</em> を読み込み設定を行います。主に 列タイトル行の存在、区切り文字 <em>(delimiter)</em> を設定します。KNIMEにデータのインポートが完了した後に、ファイルが正しくロードされているか確認します。</p>
<ol>
<li>ローカルファイルにある <code>顧客データ + 利用履歴 CSVファイル</code> を指定し、<code>Has Row Header (行見出し存在)</code> のチェックを外す</li>
<li>CSVファイルの読み込み成功後、データプレビューエリアにレコードが表示される</li>
</ol>
<p><em>Fig. CSVファイル 読込み 設定</em></p>
<p><img alt="" src="../images/knime-3/wf-part-1/wf1-node-1-1.png" /></p>
<p><em>Fig. CSVファイル テーブル表示</em></p>
<p><img alt="" src="../images/knime-3/wf-part-1/wf1-node-1-2.png" /></p>
<ul>
<li>利用ノード: <a href="https://nodepit.com/node/org.knime.base.node.io.csvreader.CSVReaderNodeFactory">IO / Read / CSV Reader</a></li>
</ul>
<h3 id="_3">クラスタリング / 処理</h3>
<p><em>Fig. クラスタリング / 処理 / ワークフロー</em></p>
<p><img alt="" src="../images/knime-3/wf-part-2/wf-part-2.png" /></p>
<h4 id="_4">準備 / データ探索</h4>
<p>読み込んだデータが どのような特徴を持っているのか把握しておく必要があります。<code>Data Explorer</code> ノードを使い簡単なデータ分析　- 探索的データ分析 <em>(Exploratory Data Analysis: EDA)</em> を行います。次の情報を確認します。</p>
<h5 id="1">1. 月の利用回数の分布</h5>
<p>利用者の月の利用回数は、3回から5回が多いことがわかります</p>
<p><em>Fig. データ探索 / mean (利用回数 平均/月)</em></p>
<p><img alt="" src="../images/knime-3/wf-part-2/wf2-node-2-1.png" /></p>
<h5 id="2">2. 会員期間の分布</h5>
<p>会員期間は、1年未満の利用者が多いことがわかります。依って、一年以上の会員期間の利用者は、継続的に利用していることがわかります</p>
<p><em>Fig. データ探索 / membership_period (会員期間)</em></p>
<p><img alt="" src="../images/knime-3/wf-part-2/wf2-node-2-2.png" /></p>
<h5 id="3">3. 退会会員数</h5>
<p>退会会員数は、継続会員数の約半数ということがわかります</p>
<p><em>Fig. データ探索 / membership is_deleted (退会)</em></p>
<p><img alt="" src="../images/knime-3/wf-part-2/wf2-node-2-3.png" /></p>
<h5 id="4">4. 月額金額の分布</h5>
<p>月額金額は三種類あり <em>[6000円, 7500円, 10500円]</em> 、その中でも10,500円のコースの会員数が他のそれぞれのコースの二倍近くいることがわかります</p>
<p><em>Fig. データ探索 / membership price (月額)</em></p>
<p><img alt="" src="../images/knime-3/wf-part-2/wf2-node-2-4.png" /></p>
<h5 id="5">5. 質的データの要約</h5>
<p>データの要約 <em>(サマリー)</em> を見ていくと、このデータの概要を理解することができます。</p>
<p><code>end_date</code> の結果は、退会した人が 2842人いて ユニークな値が 12存在します。「2842人が退会した日が12日ある」ことを意味します。その一方、<code>start_date</code> の結果は、「入会日は 215日ある」その日数は、退会日よりも多いことがわかります。その他、クラ数数、キャンペーンう数等を把握することができます。</p>
<p><em>Fig. データ探索 / Nominal</em></p>
<p><img alt="" src="../images/knime-3/wf-part-2/wf2-node-2-5.png" /></p>
<ul>
<li>利用ノード: <a href="https://nodepit.com/node/org.knime.base.node.stats.dataexplorer.DataExplorerNodeFactory">Nodes / KNIME Labs / JavaScript Views (Labs) / Data Explorer</a></li>
</ul>
<h4 id="_5">正規化</h4>
<p>クラスタリング処理を行う前に 数値データのスケールを 0から1の範囲に線形変換 <em>(Linear transformation)</em> します。</p>
<p>正規化 設定画面で、正規化対象のカラム - <code>mean (平均 利用回数/月)</code>, <code>membership_pedriod (会員期間)</code> を選択します。</p>
<p><em>Fig. Normalizaer 正規化 / 設定</em></p>
<p><img alt="" src="../images/knime-3/wf-part-2/wf2-node-1-1.png" /></p>
<p>正規化処理後、<code>mean (平均 利用回数/月)</code>, <code>membership_pedriod (会員期間)</code> の各列の値が 「0〜1 の範囲」に変換されたことを確認します。</p>
<p><em>Fig. Normalizaer 正規化 / 正規化 後テーブル</em></p>
<p><img alt="" src="../images/knime-3/wf-part-2/wf2-node-1-2.png" /></p>
<ul>
<li>利用ノード: <a href="https://nodepit.com/node/org.knime.base.node.preproc.normalize3.Normalizer3NodeFactory">Nodes / Manipulation / Column / Transform / Normalizer</a></li>
</ul>
<h4 id="_6">クラスタリング</h4>
<p>トレーニングジムの会員の行動傾向を4つのクラスターに分けます。クラスタリング 設定画面の <code>Number of clusters (クラスター数)</code> の値を 「4」に設定します。また、クラスタリングに必要なカラムに <code>mean (平均利用回数/月)</code> と <code>membership_period (会員期間)</code> の二つを選択します。</p>
<p><em>Fig. クラスタリング 設定</em></p>
<p><img alt="" src="../images/knime-3/wf-part-2/wf2-node-3-1.png" /></p>
<p>クラスタリング後の結果を コンテキストメニュー <em>(ポップアップメニュー)</em> の <code>Clusters</code> を実行し、4つのクラスターの存在と、それぞれのクラスターの値を確認します。</p>
<p><em>Fig. クラスタリング 結果 テーブル</em></p>
<p><img alt="" src="../images/knime-3/wf-part-2/wf2-node-3-3.png" /></p>
<ul>
<li>利用ノード: <a href="https://nodepit.com/workflow/com.knime.hub%2FUsers%2Ftaka%2FPublic%2Fclustering(k-means)">Workflows / KNIME Hub / Users / taka / Public / k-means</a></li>
</ul>
<h4 id="_7">クラスタリング 色指定</h4>
<p>可視化した時に 4つのクラスターに属する値を容易に判別できるように、それぞれのクラスターの色を指定します。この処理に依り、生成されたチャートにプロットされた値がどのクラスターに属しているかわかります。</p>
<p><em>Fig. クラスタリング 色指定</em></p>
<p><img alt="" src="../images/knime-3/wf-part-2/wf2-node-4-1.png" /></p>
<ul>
<li>利用ノード: <a href="https://nodepit.com/node/org.knime.base.node.viz.property.color.ColorManager2NodeFactory">Nodes / Views / Property / Color Manager</a></li>
</ul>
<h3 id="_8">クラスタリング / 集計, 可視化</h3>
<p><em>Fig. クラスタリング / 集計, 可視化</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf-part-3.png" /></p>
<h4 id="_9">テーブル結合</h4>
<p>正規化処理で 実際のデータと異なる値を持つカラム (<code>mean (平均利用回数/月)</code>, <code>membership_period (会員期間)</code>) が存在しているので、正規化前後のそれぞれの値を使えるように、正規化前の元のテーブルと正規化後のテーブルを結合します。</p>
<ul>
<li><code>join mode</code> に <code>inner join (内部結合)</code> を選択する</li>
<li>結合するカラムに <code>left table</code>、<code>right table</code> 共に <code>Row ID</code> を指定する</li>
</ul>
<p><em>Fig. テーブル結合 / 設定 (1)</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-1-1.png" /></p>
<ul>
<li><code>right table</code> には、次の3カラムを指定する <em>(重複するカラムを対象外にする)</em><ul>
<li><code>mean (平均利用回数/月)</code></li>
<li><code>membership_period (会員期間)</code></li>
<li><code>Cluster (クラスター)</code></li>
</ul>
</li>
</ul>
<p><em>Fig. テーブル結合 / 設定 (2)</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-1-2.png" /></p>
<h4 id="_10">集計</h4>
<p>集計の目的は、クラスター別 会員の行動の特徴を把握することです。このセクションでは、「クラスター別退会者集計」と「クラスター別定期利用者集計」を行います。</p>
<h5 id="_11">クラスター別退会者集計</h5>
<ul>
<li>グループ化対象カラムに、<code>Cluster (クラスター)</code>、<code>is_deleted (途中退会者)</code> を指定し、<strong>クラスター別退会者</strong> を集計する</li>
<li>集計対象カラムは、<code>customer_id (会員ID)</code>とし、集計方法は <code>Count</code> を指定する</li>
<li>集計結果の着目点は以下の通り<ul>
<li><code>cluster_0</code> 退会者数 が最も多い</li>
<li><code>cluster_1</code> 継続会員数 が二番目に多い</li>
</ul>
</li>
</ul>
<p><em>Fig. 集計 / クラスター別退会者集計 / 設定 (1)</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-2-1.png" /></p>
<p><em>Fig. 集計 / クラスター別退会者集計 / 設定 (2)</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-2-2.png" /></p>
<p><em>Fig. 集計 / クラスター別退会者集計 / 結果テーブル</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-2-3.png" /></p>
<h5 id="_12">クラスター別定期利用者集計</h5>
<ul>
<li>グループ化対象カラムに、<code>Cluster (クラスター)</code>、<code>routine_flg (定期利用フラグ)</code> を指定し、<strong>クラスター別定期利用者</strong> を集計する</li>
<li>集計対象カラムは、<code>customer_id (会員ID)</code>とし、集計方法は <code>Count</code> を指定する</li>
<li>集計結果の着目点は以下の通り<ul>
<li><code>cluster_2</code> 定期利用者数 が最も多い</li>
<li><code>cluster_1</code> 定期利用者数 が二番目に多い</li>
</ul>
</li>
</ul>
<p><em>Fig. 集計 / クラスター別定期利用者集計 / 設定 (1)</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-3-1.png" /></p>
<p><em>Fig. 集計 / クラスター別定期利用者集計 / 設定 (2)</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-3-2.png" /></p>
<p><em>Fig. 集計 / クラスター別定期利用者集計 / 結果テーブル</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-3-3.png" /></p>
<ul>
<li>利用ノード: <a href="https://nodepit.com/node/org.knime.base.node.preproc.groupby.GroupByNodeFactory">Nodes / Manipulation / RowRow / Transform / GroupBy</a></li>
</ul>
<h4 id="_13">可視化</h4>
<p>データの中にあるカテゴリー同士の類似性や関係を理解するため、チャートをいくつか作成しデータの理解を深めます。次の三種類のチャートを作成します。</p>
<ol>
<li>Parallel Coordinates Plot <em>(平行座標)</em></li>
<li>Scatter Plot / 2D/3D Scatterplot <em>(散布図)</em></li>
<li>Conditional Box Plot <em>(箱ひげ図)</em></li>
</ol>
<h5 id="1-parallel-coordinates-plot">1. Parallel Coordinates Plot</h5>
<ul>
<li>Parallel Coordinates Plot <em>(平行座標)</em> を作成するのに必要な列、<code>mean (平均利用回数/月)</code>、<code>membership_period (会員期間)</code>、<code>Cluster (クラスター)</code> を指定する</li>
<li>各列の関係 - <code>mean (平均利用回数/月)</code> =&gt; <code>membership_period (会員期間)</code> =&gt; <code>Cluster (クラスター)</code> を確認する</li>
</ul>
<p><em>Fig. 可視化 / Parallel Coordinates Plot / 設定</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-4-1.png" /></p>
<p><em>Fig. 可視化 / Parallel Coordinates Plot / 結果</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-4-2.png" /></p>
<ul>
<li>利用ノード: <a href="https://nodepit.com/node/org.knime.dynamic.js.v30.DynamicJSNodeFactory%23Parallel%20Coordinates%20Plot">Nodes / Views / JavaScript / Parallel Coordinates Plot</a></li>
</ul>
<h5 id="2-1-scatter-plot-1">2-1. Scatter Plot (1)</h5>
<ul>
<li>X軸に <code>membership_period (会員期間)</code>、Y軸に <code>mean (平均利用回数/月)</code> を指定する</li>
<li>各クラスターが色分けされプロットされていることがわかり、綺麗に4つのクラスターができていることを確認し、各クラスターの <code>membership_period (会員期間)</code>と<code>mean (平均利用回数/月)</code>の関係も確認する</li>
</ul>
<p><em>Fig. 可視化 / Scatter Plot (1) / 設定</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-5-1.png" /></p>
<p><em>Fig. 可視化 / Scatter Plot (1) / 結果</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-5-2.png" /></p>
<ul>
<li>利用ノード: <a href="https://nodepit.com/node/org.knime.js.base.node.viz.plotter.scatterSelectionAppender.ScatterPlotNodeFactory">Nodes / Views / JavaScript / Scatter Plot</a></li>
</ul>
<h5 id="2-2-scatter-plot-2">2-2. Scatter Plot (2)</h5>
<ul>
<li>「2-1. Scatter Plot (1)」と同じ</li>
</ul>
<p><em>Fig. 可視化 / Scatter Plot (2) / 設定</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-6-1.png" /></p>
<p><em>Fig. 可視化 / Scatter Plot (2) / 結果</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-6-2.png" /></p>
<ul>
<li>利用ノード: <a href="https://nodepit.com/node/org.erlwood.knime.nodes.graph.NGraphNodeFactory">Nodes / Community Nodes / Erlwood Nodes / Viewers</a></li>
</ul>
<h5 id="3-conditional-box-plot">3. Conditional Box Plot</h5>
<ul>
<li>Box Plot <em>(箱ひげ図)</em> を作成し、各クラスターの <code>membership_period (会員期間)</code> と <code>mean (平均利用回数/月)</code> の**データのばらつき**を確認する</li>
<li><code>Category column</code> に <code>Cluster (クラスター)</code> を指定、対象カラムに <code>membership_period (会員期間)</code> と <code>mean (平均利用回数/月)</code> を指定する</li>
</ul>
<p><em>Fig. 可視化 / Conditional Box Plot / 設定</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-7-1.png" /></p>
<p><em>Fig. 可視化 / Conditional Box Plot / クラスター別平均利用回数/月</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-7-2.png" /></p>
<p><em>Fig. 可視化 / Conditional Box Plot / クラスター別会員期間</em></p>
<p><img alt="" src="../images/knime-3/wf-part-3/wf3-node-7-3.png" /></p>
<ul>
<li>利用ノード: <a href="https://nodepit.com/node/org.knime.dynamic.js.v30.DynamicJSNodeFactory%23Conditional%20Box%20Plot">Nodes / Views / JavaScript / Conditional Box Plot</a></li>
</ul>
<h3 id="_14">まとめ</h3>
<p>データ分析の初期の段階でクラスタリングを行いサンプルをグループ化することで、より直感的にデータの特徴をつかむことができました。この分析結果を参考にして、会員の利用回数の予測、退会予測 等をすることができます。</p>
<p>また、データに不具合さえなければ、KNIMEには、既存のクラスタリングノード - K-Means があるので、短時間でクラスタリングを行うことができます。</p>
<h3 id="appendix">Appendix / 利用ノード一覧</h3>
<ul>
<li><a href="https://nodepit.com/node/org.knime.base.node.io.csvreader.CSVReaderNodeFactory">IO / Read / CSV Reader</a></li>
<li><a href="https://nodepit.com/node/org.knime.base.node.stats.dataexplorer.DataExplorerNodeFactory">Nodes / KNIME Labs / JavaScript Views (Labs) / Data Explorer</a></li>
<li><a href="https://nodepit.com/node/org.knime.base.node.preproc.normalize3.Normalizer3NodeFactory">Nodes / Manipulation / Column / Transform</a></li>
<li><a href="https://nodepit.com/workflow/com.knime.hub%2FUsers%2Ftaka%2FPublic%2Fclustering(k-means)">Workflows / KNIME Hub / Users / taka / Public / k-means</a></li>
<li><a href="https://nodepit.com/node/org.knime.base.node.viz.property.color.ColorManager2NodeFactory">Nodes / Views / Property / Color Manager</a></li>
<li><a href="https://nodepit.com/node/org.knime.base.node.preproc.groupby.GroupByNodeFactory">Nodes / Manipulation / RowRow / Transform / GroupBy</a></li>
<li><a href="https://nodepit.com/node/org.knime.dynamic.js.v30.DynamicJSNodeFactory%23Parallel%20Coordinates%20Plot">Nodes / Views / JavaScript / Parallel Coordinates Plot</a></li>
<li><a href="https://nodepit.com/node/org.knime.js.base.node.viz.plotter.scatterSelectionAppender.ScatterPlotNodeFactory">Nodes / Views / JavaScript / Scatter Plot</a></li>
<li><a href="https://nodepit.com/node/org.erlwood.knime.nodes.graph.NGraphNodeFactory">Nodes / Community Nodes / Erlwood Nodes / Viewers</a></li>
<li><a href="https://nodepit.com/node/org.knime.dynamic.js.v30.DynamicJSNodeFactory%23Conditional%20Box%20Plot">Nodes / Views / JavaScript / Conditional Box Plot</a></li>
</ul>
<style>
.md-typeset h1 {
    margin: 0 0 2rem;
    color: var(--md-default-fg-color--light);
    font-weight: 500;
    font-size: 1.4rem;
    line-height: 1.15;
    letter-spacing: -0.01em;
}
.md-typeset h2 {
    margin: 2rem 0 .8rem;
    font-weight: 450;
    font-size: 1.2rem;
    line-height: 1.4;
    letter-spacing: -0.01em;
}
.md-typeset h3 {
    margin: 1.6rem 0 .8rem;
    font-weight: 450;
    font-size: 1.0rem;
    line-height: 1.5;
    letter-spacing: -0.01em;
}
.md-typeset h4 {
    margin: .8rem 0;
    f====ont-weight: 450;
    font-size: .8rem;
    letter-spacing: -0.01em;
}
.md-typeset h5, .md-typeset h6 {
    margin: .8rem 0;
    color: black;
    font-weight: 450;
    font-size: .75rem;
    letter-spacing: -0.01em;
}
.md-nav {
    font-size: .6rem;
    line-height: 1.3;
}
.md-typeset {
    font-size: .7rem;
    line-height: 1.6;
    -webkit-print-color-adjust: exact;
    color-adjust: exact;
}
</style>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../knime-2/" title="KNIME 入門編 / 探索的データ分析" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                KNIME 入門編 / 探索的データ分析
              </div>
            </div>
          </a>
        
        
          <a href="../knime-4/" title="KNIME 実践編 / 解約予測" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                KNIME 実践編 / 解約予測
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            (c) 2020 <a href="https://lions-data.com">Lions Data, Ltd.</a> All rights reserved.
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.92ffa368.min.js"></script>
      <script src="../../../assets/javascripts/bundle.5123e3d4.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>